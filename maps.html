<!DOCTYPE html>
<html>
<head>
  <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="bootstrap.min.css" rel="stylesheet"/>
  <script src="bootstrap.bundle.min.js" > </script>
  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }



    .sidebar {
      height: 100%;
      width: 0;
      position: fixed;
      z-index: 1;
      top: 0;
      left: 0;
      background-color: #ff6699;
      overflow-x: hidden;
      transition: 0.5s;
      padding-top: 60px;
    }

    .sidebar .closebtn {
      position: absolute;
      top: 0;
      right: 25px;
      font-size: 36px;
      margin-left: 50px;
    }

    .openbtn {
      font-size: 20px;
      cursor: pointer;
      background-color: #ff6699;
      color: white;
      padding: 10px 15px;
      border: none;
    }

    .openbtn:hover {
      background-color: #444;
    }

    #main {
      transition: margin-left .5s;
      padding: 16px;
    }

    /* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
    @media screen and (max-height: 450px) {
      .sidebar {padding-top: 15px;}
      .sidebar a {font-size: 18px;}
    }    
    
  </style>
  
  <!-- Custom styles for this template -->
  <link href="main.css" rel="stylesheet">

</head>
<script>

if (document.location.search.match(/type=embed/gi)) {
    window.parent.postMessage("resize", "*");
  }
// JavaScript program to print all
// paths from a source to
// destination.

let v;

let adjList;

var resultpathList = {};
var pathcnt = 0;

var tuimage = new Array(17);

tuimage[0] = { name:"b1_01.jpg", thumbnail:"b1_01s.jpg", tag:"ตึก, ตึก1"};
tuimage[1] = { name:"pr_01.jpg", thumbnail:"pr_01s.jpg", tag:"pr, PR, Pr, ประชาสัมพันธ์"};
tuimage[2] = { name:"b3_01.jpg", thumbnail:"b3_01s.jpg", tag:"ตึก, ตึก3"};
tuimage[3] = { name:"b2_01.jpg", thumbnail:"b2_01s.jpg", tag:"ตึก, ตึก2"};
tuimage[4] = { name:"hf_01.jpg", thumbnail:"hf_01s.jpg", tag:"hall, ห้องเกียรติยศ"};
tuimage[5] = { name:"b80_01.jpg", thumbnail:"b80_01s.jpg", tag:"ตึก, ตึก80"};
tuimage[6] = { name:"ba_01.jpg", thumbnail:"ba_01s.jpg", tag:"ตึก, ตึกศิลปะ"};
tuimage[7] = { name:"dr_01.jpg", thumbnail:"dr_01s.jpg", tag:"ประตู, หน้ารร, ประตูพญาไท"};
tuimage[8] = { name:"ya_01.jpg", thumbnail:"ya_01s.jpg", tag:"ลาน, atm, ATM"};
tuimage[9] = { name:"yv_01.jpg", thumbnail:"yv_01s.jpg", tag:"ลาน, วอลเลย์บอล, บอล"};
tuimage[10] = { name:"hf_02.jpg", thumbnail:"hf_02s.jpg", tag:"hall, หอประชุม, หอประชุมใหญ่, โรงใหญ่"};
tuimage[11] = { name:"ct_01.jpg", thumbnail:"ct_01s.jpg", tag:"canteen, โรงอาหาร, ตึก80"};
tuimage[12] = { name:"s_rama5.jpg", thumbnail:"s_rama5s.jpg", tag:"ร.5, ศาลร.5"};
tuimage[13] = { name:"hf_03.jpg", thumbnail:"hf_03s.jpg", tag:"ศาลา, ศาลาดนตรีไทย, ดนตรี"};
tuimage[14] = { name:"hf_04.jpg", thumbnail:"hf_04s.jpg", tag:"ศาลา, ศาลาพระเกี้ยวแก้ว, พระเกี้ยว"};
tuimage[15] = { name:"tl_01.jpg", thumbnail:"tl_01s.jpg", tag:"ห้องน้ำ, ห้องน้ำตึกศิลปะ, ตึกศิลปะ"};
tuimage[16] = { name:"tl_02.jpg", thumbnail:"tl_02s.jpg", tag:"ห้องน้ำ, ห้องน้ำโรงใหญ่, โรงใหญ่"};

// var location = new Array(84);

location[0] = { "name":"ทางเลี้ยวเข้าสนตอ", "tag":"", "x":1191, "y":92}
location[1] = { "name":"ห้องพยาบาลพุทธรักษา", "tag":"ห้องพยาบาล", "x":1271, "y":92}
location[2] = { "name":"ตึกคุณหญิงหรั่ง", "tag":"ตึก, หรั่ง", "x":1366, "y":92}
location[3] = { "name":"สมาคมนักเรียนเก่าโรงเรียนเตรียมอุดมศึกษา", "tag":"สนตอ", "x":1412, "y":92}
location[4] = { "name":"สวนพฤกษศาสตร์", "tag":"เรือนเกษตร, เกษตร, สวน", "x":709, "y":139}
location[5] = { "name":"ตึก 72 พรรษา", "tag":"ตึก, 72", "x":763, "y":139}
location[6] = { "name":"สามแยก72", "tag":"", "x":798, "y":139}
location[7] = { "name":"ห้องน้ำตึก 72 ปี", "tag":"ห้องน้ำ, 72", "x":947, "y":139}
location[8] = { "name":"ตึก 8", "tag":"ตึก, 8", "x":1061, "y":139}
location[9] = { "name":"ห้องน้ำตึก 8", "tag":"ตึก, 8", "x":1141, "y":139}
location[10] = { "name":"สามแยกหญิงหรั่ง", "tag":"", "x":1191, "y":139}
location[11] = { "name":"ตึก 60 ปี", "tag":"ตึก, 60", "x":709, "y":208}
location[12] = { "name":"สามแยกหญิงหรั่งล่าง", "tag":"", "x":1191, "y":208}
location[13] = { "name":"ห้องน้ำตึกคุณหญิงหรั่ง", "tag":"ห้องน้ำ, หรั่ง", "x":1373, "y":208}
location[14] = { "name":"ทางเลี้ยวห้องน้ำหญิงหรั่ง", "tag":"", "x":1373, "y":235}
location[15] = { "name":"ทางเลี้ยงหญิงหรั่งไปประตูฟ้า", "tag":"", "x":1412, "y":235}
location[16] = { "name":"ประตูตึก 50 ปี", "tag":"ประตู, ประตูฟ้า", "x":1412, "y":283}
location[17] = { "name":"โรงอาหารโดมทอง", "tag":"โรงอาหาร, โดมทอง", "x":1191, "y":325}
location[18] = { "name":"โรงอาหารตึก 50 ปี", "tag":"โรงอาหาร, 50", "x":1295, "y":325}
location[19] = { "name":"ตึก 50 ปี", "tag":"ตึก, 50", "x":1359, "y":325}
location[20] = { "name":"ห้องน้ำตึก 55 ปี", "tag":"ห้องน้ำ, 55", "x":1412, "y":325}
location[21] = { "name":"ทางเลี้ยงห้องน้ำ60", "tag":"", "x":678, "y":356}
location[22] = { "name":"สามแยกลานบานเย็น", "tag":"", "x":709, "y":356}
location[23] = { "name":"สนามฟุตบอล", "tag":"สนาม, สนามบอล", "x":798, "y":356}
location[24] = { "name":"ห้องน้ำตึก 60 ปี", "tag":"ห้องน้ำ, 60", "x":678, "y":405}
location[25] = { "name":"ตึก 55 ปี", "tag":"ตึก, 55", "x":1295, "y":405}
location[26] = { "name":"ทางเลี้ยวโดมทอง", "tag":"", "x":1191, "y":441}
location[27] = { "name":"สามแยกโดมทอง", "tag":"", "x":1213, "y":441}
location[28] = { "name":"ทางเลี้ยว55", "tag":"", "x":1297, "y":441}
location[29] = { "name":"ทางเลี้ยวโรงยิม", "tag":"", "x":650, "y":454}
location[30] = { "name":"ตึก 9", "tag":"ตึก, 9", "x":729, "y":454}
location[31] = { "name":"โรงยิม", "tag":"ยิม", "x":650, "y":540}
location[32] = { "name":"ทางเลี้ยว81", "tag":"", "x":990, "y":540}
location[33] = { "name":"ทางเลี้ยวขวาโล่ง", "tag":"", "x":1213, "y":540}
location[34] = { "name":"ทางเลี้ยวโรงใหญ่", "tag":"", "x":638, "y":621}
location[35] = { "name":"สามแยกลาน70", "tag":"", "x":737, "y":621}
location[36] = { "name":"สามแยกห้องน้ำ81", "tag":"", "x":798, "y":621}
location[37] = { "name":"ทางเลี้ยวห้องน้ำ81", "tag":"", "x":798, "y":641}
location[38] = { "name":"ตึก 81 ปี", "tag":"ตึก, 81", "x":848, "y":641}
location[39] = { "name":"สามแยกแปดเอ็ด", "tag":"", "x":990, "y":641}
location[40] = { "name":"โรงใหญ่", "tag":"โรงอาหาร", "x":638, "y":706}
location[41] = { "name":"ห้องน้ำตึกศิลปะ", "tag":"ห้องน้ำ, ศิลปะ", "x":199, "y":739}
location[42] = { "name":"ตึกศิลปะ", "tag":"ตึก, ศิลปะ", "x":334, "y":739}
location[43] = { "name":"ทางเลี้ยวตึกศิลปะ", "tag":"", "x":442, "y":739}
location[44] = { "name":"สามแยกคูบัว", "tag":"", "x":442, "y":782}
location[45] = { "name":"หลังลานเทเล", "tag":"", "x":521, "y":782}
location[46] = { "name":"สามแยกเทเล", "tag":"", "x":592, "y":782}
location[47] = { "name":"ศาลาดนตรีไทย", "tag":"ศาลา, ดนตรี", "x":638, "y":782}
location[48] = { "name":"ทางเลี้ยวซ้ายหอสมุด", "tag":"", "x":848, "y":782}
location[49] = { "name":"หอสมุด", "tag":"ห้องสมุด, หอ", "x":904, "y":782}
location[50] = { "name":"ทางเลี้ยวขวาหอสมุด", "tag":"", "x":990, "y":782}
location[51] = { "name":"สามแยกสวนหิน", "tag":"", "x":592, "y":861}
location[52] = { "name":"สนามวอลเลย์บอล", "tag":"สนาม, วอล, วอลเลย์", "x":635, "y":861}
location[53] = { "name":"สนามบาส", "tag":"สนาม, บาส", "x":904, "y":861}
location[54] = { "name":"ห้องนันทนาการ", "tag":"ห้อง, นันทนาการ", "x":999, "y":861}
location[55] = { "name":"สามแยกตึกหนึ่งบน", "tag":"", "x":199, "y":879}
location[56] = { "name":"ลานเทเล", "tag":"ลาน, เทเลทับบี้", "x":442, "y":879}
location[57] = { "name":"ประชาสัมพันธ์", "tag":"ประชา, ประชาสัมพันธ์", "x":199, "y":929}
location[58] = { "name":"สวนหินปิ่นหทัย", "tag":"สวนหิน, สวน, ปิ่นหทัย", "x":592, "y":929}
location[59] = { "name":"ทางเลี้ยว2.5", "tag":"", "x":884, "y":929}
location[60] = { "name":"ทางเลี้ยวหนามบาส", "tag":"", "x":898, "y":898}
location[61] = { "name":"ประตูพญาไท", "tag":"ประตู, พญาไท", "x":145, "y":1023} 
location[62] = { "name":"สามแยกพญาไท", "tag":"", "x":199, "y":1023}
location[63] = { "name":"ตึก 1", "tag":"ตึก, 1", "x":290, "y":1023}
location[64] = { "name":"ห้องน้ำตึก 1", "tag":"ห้องน้ำ, 1", "x":398, "y":1023} 
location[65] = { "name":"สามแยกพยบ1", "tag":"", "x":442, "y":1023}
location[66] = { "name":"สามแยก2ซ้าย", "tag":"", "x":592, "y":1023}
location[67] = { "name":"ตึก 2", "tag":"ตึก, 2", "x":737, "y":1023}
location[68] = { "name":"สามแยก2ขวา", "tag":"", "x":884, "y":1023}
location[69] = { "name":"ห้องน้ำสนามเทนนิส", "tag":"ห้องน้ำ, เทนนิส, 2.5, ห้องน้ำ 2.5", "x":952, "y":1023}
location[70] = { "name":"สามแยก3", "tag":"", "x":999, "y":1023}
location[71] = { "name":"ตึก 3", "tag":"ตึก, 3", "x":1113, "y":1023}
location[72] = { "name":"ประตูปทุมวัน", "tag":"ปทุมวัน, ประตู, มศว", "x":1274, "y":1023}
location[73] = { "name":"สามแยกตึก9", "tag":"", "x":678, "y":454}
location[74] = { "name":"ลานบานเย็น", "tag":"ลาน, บานเย็น", "x":709, "y":208}
location[75] = { "name":"ลาน 70 ปี", "tag":"ลาน, 70", "x":690, "y":621}
location[76] = { "name":"ห้องน้ำตึก 81 ปี", "tag":"ห้องน้ำ, 81", "x":848, "y":641}
location[77] = { "name":"ลาน ATM", "tag":"ลาน", "x":638, "y":706}
location[78] = { "name":"ตึก 80 ปี", "tag":"ตึก, 80", "x":638, "y":706}
location[79] = { "name":"โรงอาหารตึก 80 ปี", "tag":"โรงอาหาร, 80", "x":638, "y":706}
location[80] = { "name":"ห้องน้ำตึก 80 ปี", "tag":"ห้องน้ำ, 80", "x":638, "y":706}
location[81] = { "name":"สนามเทนนิส", "tag":"สนาม, เทนนิส", "x":904, "y":861}
location[82] = { "name":"รูปปั้นร.5", "tag":"ร.5, รูปปั้น", "x":145, "y":1023}
location[83] = { "name":"ห้องพยาบาลตึก 1", "tag":"ห้องพยาบาล, 1, ห้อง, พยาบาล", "x":398, "y":1023}


</script>
<body>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="bootstrap" viewBox="0 0 118 94">
      <title>Bootstrap</title>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M24.509 0c-6.733 0-11.715 5.893-11.492 12.284.214 6.14-.064 14.092-2.066 20.577C8.943 39.365 5.547 43.485 0 44.014v5.972c5.547.529 8.943 4.649 10.951 11.153 2.002 6.485 2.28 14.437 2.066 20.577C12.794 88.106 17.776 94 24.51 94H93.5c6.733 0 11.714-5.893 11.491-12.284-.214-6.14.064-14.092 2.066-20.577 2.009-6.504 5.396-10.624 10.943-11.153v-5.972c-5.547-.529-8.934-4.649-10.943-11.153-2.002-6.484-2.28-14.437-2.066-20.577C105.214 5.894 100.233 0 93.5 0H24.508zM80 57.863C80 66.663 73.436 72 62.543 72H44a2 2 0 01-2-2V24a2 2 0 012-2h18.437c9.083 0 15.044 4.92 15.044 12.474 0 5.302-4.01 10.049-9.119 10.88v.277C75.317 46.394 80 51.21 80 57.863zM60.521 28.34H49.948v14.934h8.905c6.884 0 10.68-2.772 10.68-7.727 0-4.643-3.264-7.207-9.012-7.207zM49.948 49.2v16.458H60.91c7.167 0 10.964-2.876 10.964-8.281 0-5.406-3.903-8.178-11.425-8.178H49.948z"></path>
    </symbol>
    <symbol id="home" viewBox="0 0 16 16">
      <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"/>
    </symbol>
    <symbol id="table" viewBox="0 0 16 16">
      <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"/>
    </symbol>
    <symbol id="people-circle" viewBox="0 0 16 16">
      <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
      <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
    </symbol>
    <symbol id="chat-quote-fill" viewBox="0 0 16 16">
      <path d="M16 8c0 3.866-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.584.296-1.925.864-4.181 1.234-.2.032-.352-.176-.273-.362.354-.836.674-1.95.77-2.966C.744 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7zM7.194 6.766a1.688 1.688 0 0 0-.227-.272 1.467 1.467 0 0 0-.469-.324l-.008-.004A1.785 1.785 0 0 0 5.734 6C4.776 6 4 6.746 4 7.667c0 .92.776 1.666 1.734 1.666.343 0 .662-.095.931-.26-.137.389-.39.804-.81 1.22a.405.405 0 0 0 .011.59c.173.16.447.155.614-.01 1.334-1.329 1.37-2.758.941-3.706a2.461 2.461 0 0 0-.227-.4zM11 9.073c-.136.389-.39.804-.81 1.22a.405.405 0 0 0 .012.59c.172.16.446.155.613-.01 1.334-1.329 1.37-2.758.942-3.706a2.466 2.466 0 0 0-.228-.4 1.686 1.686 0 0 0-.227-.273 1.466 1.466 0 0 0-.469-.324l-.008-.004A1.785 1.785 0 0 0 10.07 6c-.957 0-1.734.746-1.734 1.667 0 .92.777 1.666 1.734 1.666.343 0 .662-.095.931-.26z"/>
    </symbol>
    <symbol id="gear-fill" viewBox="0 0 16 16">
      <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
    </symbol>
    <symbol id="tools" viewBox="0 0 16 16">
      <path d="M1 0L0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.356 3.356a1 1 0 0 0 1.414 0l1.586-1.586a1 1 0 0 0 0-1.414l-3.356-3.356a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.68-2.643A3.005 3.005 0 0 0 16 3c0-.269-.035-.53-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814L1 0zm9.646 10.646a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708zM3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026L3 15l-.471-.242L2 14.732l-.287-.445L1.268 14l-.026-.529L1 13l.242-.471.026-.529.445-.287.287-.445.529-.026L3 11z"/>
    </symbol>
    <symbol id="people-circle" viewBox="0 0 16 16">
      <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
      <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
    </symbol>
  
  </svg>
  <div id="mySidebar" class="sidebar">  
    <div class="d-flex flex-column flex-shrink-0 p-3 text-white" style="width: 280px;background-color: #ff6699;">
        <span class="fs-4">TU Magic Door</span>
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>        
      <hr>
      <form>
        <div class="form-group">
          <label for="searchInput">ค้นหา</label>
          <input type="input" class="form-control" id="searchInput" placeholder="พิมพ์คำค้นหา">
        </div>
        <div class="form-group">
          <label for="startLocation">จุดเริ่มต้น</label>
          <select class="form-select" id="startLocation">
          </select>
        </div>
        <div class="form-group">
          <label for="endLocation">ปลายทาง</label>
          <select class="form-select" id="endLocation">
          </select>
        </div>
        <div class="form-group">
          <label for="pathtodest">แสดงเส้นทาง</label>
          <textarea class="form-control" id="pathtodest" rows="10" readonly="True"></textarea>
        </div>
      </form>

      <hr>
      <div class="dropdown">
        <a id="chatlink" href="#" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
          <svg class="bi me-2" width="40" height="32"><use xlink:href="#chat-quote-fill"/></svg>
          <span class="fs-4">Chat with us</span>
        </a>
      </div>

      <div class="card" id="msgWindow">
        <div class="card-header"><span class="card-title" style="color: black;">Chat with TU Magic Door Users</span></div>
        <div class="card-body" id="msgs">
          <div class="msg to" style="color:black;">Hello! How can I assist you today?</div>
        </div>
        <div class="card-footer">
          <div class="input-group" data-sender="me">
            <input class="form-control" type="text" placeholder="Name" id="userName"/>
          </div>
          <div class="input-group" data-sender="me">
            <input class="form-control" type="text" placeholder="Type message and hit [Enter] to send." id="newMsg"/>
            <input type="hidden" id="sessionId" name="sessionId" value="">
          </div>
          <div class="input-group" data-sender="me">
            <button class="btn btn-outline-secondary" type="button" id="sendBtn">Send</button>
            <div class="input-group-append">
              <button class="btn btn-outline-danger" type="button" id="closeBtn">Close</button>
            </div>
          </div>


        </div>
      </div>
    </div>
  </div>
  <div id="main">
    <button class="openbtn" onclick="openNav()">☰ Open Menu</button>    
    <div class="d-flex flex-column flex-grow-1 p-3 bg-light">
      <div class="col-md-10 px-0">
        <canvas id="mymap" width=1522 height=1076 class="img-fluid">

        <!-- <img src="./tumagicdoor-map.png" class="img-fluid"> -->
      </div>
    </div>
  </div>


  <div id="imageGallery" data-toggle="modal" data-target="#galleryModal">
    <div class="container" >
      <div class="carousel-viewport">
        <ul class="items" id="itemList">
          <li class="item">    
            <img class="image" src="images/b1_01.jpg">
          </li>
          <li class="item">      
            <img class="image" src="images/b2_01.jpg">
          </li>
        </ul>
      </div>
      <button class="carousel-control prev" title="Go to previous item">
        <svg viewBox="0 0 256 512">
          <path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z" />
        </svg>
      </button>
      <button class="carousel-control next" title="Go to next item">
        <svg viewBox="0 0 256 512">
          <path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z" />
        </svg>
      </button>
      <ol class="carousel-dots" id="dotList">
        <li class="dot active">1</li>
        <li class="dot">2</li>
      </ol>            
    </div>
  </div>

  <script src="jquery.min.js" > </script>

  <script type="module">

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const config = {
      apiKey: "AIzaSyBs_va3fzOu0CY89vldribf2TCZZJ5qtEg",
      authDomain: "tumagicdoor.firebaseapp.com",
      databaseURL: "https://tumagicdoor-default-rtdb.firebaseio.com",
      projectId: "tumagicdoor",
      storageBucket: "tumagicdoor.appspot.com",
      messagingSenderId: "776850631036",
      appId: "1:776850631036:web:b8835469c90cf0dc78dcf9"
    };
    
    // Initialize Firebase
    const app = initializeApp(config);
    import { getDatabase, ref, set, push, onChildAdded, onValue } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-database.js"

    const db = getDatabase(app) // <-- Pass in the initialized app
    //Creating the reference (The path in db you are trying to read/write/update)
    const myDataRef = ref(db, "/chat")


    const chatRef = ref(db, 'chat');
    onValue(chatRef, (snapshot) => {
      const data = snapshot.val();

      if ($("#sessionId").val() != data.sessid) {
        let theEnvelope = {
            msg: data.msg,
            sender: data.name };

          _send(theEnvelope);
      }

      // displayChatMessage(data.name, data.msg);
    });      



    function _send(data) {
      // Send data to a new .msg
      let $msg = $('<div class="msg"></div>'),
      { sender, typing } = data;
      if (sender !== "me") {
        $msg.addClass("to");
        $msg.css("color","black");
        $msg.text(data.sender + ' : ' + data.msg);
      } else {
        $msg.addClass("from");
        $msg.css("color","green");
        $msg.text(data.msg);
      }
      if (typing) $msg.addClass("typing");
      $msg.appendTo($("#msgs"));
      if (typing) return $msg; // ref to new DOM .msg

    }


    // Define event handlers: Hitting Enter or Send should send the form.
    $("#newMsg").on("keypress", function (e) {
      // @TODO: Allow [mod] + [enter] to expand field & insert a <BR>
      if (e.which === 13) {
        // Stop the prop
        e.stopPropagation();e.preventDefault();
        // Wrap the msg and send!

        set(ref(db, 'chat'), {name: $("#userName").val(), msg: $("#newMsg").val(), sessid: $("#sessionId").val()});

        let theEnvelope = {
          msg: $("#newMsg").val(),
          sender: "me" };

        $("#newMsg").val("");

        return _send(theEnvelope);
      } else {
        // goggles
      }
    });
    $("#sendBtn").on("click", function (e) {
      // Stop the prop
      e.stopPropagation();e.preventDefault();
      // Wrap the msg and send!

      set(ref(db, 'chat'), {name: $("#userName").val(), msg: $("#newMsg").val(), sessid: $("#sessionId").val()});

      let theEnvelope = {
        msg: $("#newMsg").val(),
        sender: "me" };

      $("#newMsg").val("");

      return _send(theEnvelope);
    });        


  </script>


  <script type="text/javascript">
  //<![CDATA[

  function openNav() {
    document.getElementById("mySidebar").style.width = "280px";
    document.getElementById("main").style.marginLeft = "280px";
  }

  function closeNav() {
    document.getElementById("mySidebar").style.width = "0";
    document.getElementById("main").style.marginLeft= "0";
  }


  // $("#startLocation").selectpicker();
    jQuery(document).ready(function($) {


        var rand = function() {
          return Math.random().toString(36).substr(2); // remove `0.`
        };

        $('#searchInput').keyup(function(){
            var value = $(this).val().trim();
            var showimg = false;
            var firstItem = true;
            var itemcnt = 0;
            if (value.length >= 3) {
              for(i=0; i< Object.keys(tuimage).length; i++) {
                  if(tuimage[i] !== undefined && tuimage[i].tag.length > 0) {
                    let result = tuimage[i].tag.indexOf(value);
                    if (result > -1) {
                      console.log(tuimage[i]);
                      itemcnt++;
                      if (firstItem) {
                        showimg = true;
                        firstItem = false;
                        $("#dotList").empty().append('<li class="dot active">1</li>');
                        $("#itemList").empty().append('<li class="item"><img class="image" src="images/'+ tuimage[i].name+'"></li>');
                      } else {
                        $("#dotList").append('<li class="dot">'+itemcnt.toString()+'</li>');
                        $("#itemList").append('<li class="item"><img class="image" src="images/'+ tuimage[i].name+'"></li>');
                      }

                    }
                  }
              }
            }
            if (showimg) {
              document.getElementById("imageGallery").style.display = "block";

              /* for image gallery */
              /* Carousel */
              const items = document.querySelector(".items");
              const dots = document.querySelectorAll(".dot");
              const prev = document.querySelector(".prev");
              const next = document.querySelector(".next");
              const total = items.children.length - 1;
              const active = "active";
              let current = 0;

              const setActiveDot = () => {
                dots.forEach((button, i) => {
                  i === current
                    ? button.classList.add(active)
                    : button.classList.remove(active);
                });
              };

              const scrollToCurrent = () => {
                items.style.transform = `translateX(${current * -100}%`;
                setActiveDot();
              };

              const scrollPrev = () => {
                if (current === 0) return;
                current--;
                scrollToCurrent();
              };

              const scrollNext = () => {
                if (current === total) return;
                current++;
                scrollToCurrent();
              };

              prev.addEventListener("click", scrollPrev);
              next.addEventListener("click", scrollNext);        
              scrollToCurrent();


            } else {
              document.getElementById("imageGallery").style.display = "none";
            }


        });


        function drawPath() {

          var data = '';
          let s = $("#startLocation").val();
          let d = $("#endLocation").val();


          ctx.clearRect(0, 0, mymap.width, mymap.height);
          // img.src = './tumagicdoor-map.png';
          ctx.drawImage(img, 0, 0, mymap.width, mymap.height);

          for(var i = 0; i < mypath.length; i++) {
            
            if ( s == mypath[i].start && d == mypath[i].end) {
                  data = mypath[i].path;
                  break;
                }
            } 

          $("#pathtodest").empty();

          const mylocation = data.split(",");

          if (mylocation != '') {
            k = parseInt(mylocation[0]);
            ctx.beginPath();
            ctx.moveTo(location[k].x, location[k].y);

            for(i=0; i < mylocation.length; i++) {
              k = parseInt(mylocation[i]);
              $("#pathtodest").append(location[k].name + "\n");
              if (i > 0) {
                ctx.lineTo(location[k].x, location[k].y);
              }

            }

            ctx.lineWidth = 3;
            ctx.strokeStyle = "red";

            ctx.stroke();
          } else {
            $("#pathtodest").append("Direction not assigned.\n");
          }

        }

        function locationLoad() {

            for(i=0; i< Object.keys(location).length; i++) {
                if(location[i] !== undefined && location[i].tag.length > 0) {
                    $("#startLocation").append('<option value="'+i+'" selected="">'+location[i].name+'</option>');
                    $("#endLocation").append('<option value="'+i+'" selected="">'+location[i].name+'</option>');
                }

            }

            // sort name
            var my_options = $("#startLocation option");
            var selected = $("#startLocation").val();
            var end_options = $("#endLocation option");
            var endselected = $("#endLocation").val();

            my_options.sort(function(a,b) {
                if (a.text > b.text) return 1;
                if (a.text < b.text) return -1;
                return 0
            });

            end_options.sort(function(a,b) {
            if(a.text > b.text) return 1;
            if(a.text < b.text) return -1;
            return 0
            });

            $("#startLocation").empty().append( my_options );
            $("#startLocation").val(selected);    
            $("#endLocation").empty().append( end_options );
            $("#endLocation").val(endselected);    
            $("#startLocation").prop('selectedIndex', 0);
            var length = $('#endLocation').children('option').length;
            $("#endLocation").prop('selectedIndex', length-1);

        }  

        //sidebar
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        tooltipTriggerList.forEach(function (tooltipTriggerEl) {
          new bootstrap.Tooltip(tooltipTriggerEl)
        })


        var mypath;
        $.getJSON("./data.json", function(data) { mypath = data; });

        var ctx = document.getElementById('mymap');
        var img = new Image();
        if(ctx.getContext) {
            ctx = ctx.getContext('2d');
            img.onload = function() {
                ctx.drawImage(img, 0, 0, mymap.width, mymap.height);
            }
            img.src = './tumagicdoor-map.png';
        }

        $("#startLocation").change(function() {
            drawPath();
        });


        $("#endLocation").change(function() {
            drawPath();
        });


        $("#chatlink").click(function(){ 
          document.getElementById("msgWindow").style.display = "grid";
          return false; 
        });
        $("#closeBtn").click(function(){ 
          document.getElementById("msgWindow").style.display = "none"; 
          return false; 
        });

        $("#sessionId").val(rand() + rand());

        locationLoad();



    });

  //]]>
  </script>

</body>
</html>
